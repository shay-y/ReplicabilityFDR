<html>
	<head>
		<!--<META HTTP-EQUIV="CACHE-CONTROL" CONTENT="NO-CACHE">-->
    <script src="shared/jquery.js" type="text/javascript"></script>
    <script src="shared/shiny.js" type="text/javascript"></script>
    <link rel="stylesheet" type="text/css" href="shared/shiny.css"/>
		<script type="text/javascript" src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
		<script type="text/javascript" src="http://code.jquery.com/jquery-1.8.3.min.js"></script>
    <script type="text/javascript" src="jquery.qtip-1.0.0-rc3.min.js"></script>
		<meta name="description" content="web applet | ReplicabilityFDR | A tool for computing the r-values from primary and follow-up studies." />
		<meta name="keywords" content="Ruth Heller" />
		<meta name="author" content="Shay Yaacoby" />
		<meta charset="UTF-8">
		
		<title>Replicability Analysis</title>
		<link rel="stylesheet" type="text/css" href="app.css" media="screen" />

	<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-35267674-2', 'auto');
  ga('send', 'pageview');

</script>

<script type="text/javascript">
/*if (typeof jQuery != 'undefined') {
    jQuery(document).ready(function($) {
        var filetypes = /\.(zip|exe|pdf|doc*|xls*|ppt*|mp3)$/i;
        var baseHref = '';
        if (jQuery('base').attr('href') != undefined)
            baseHref = jQuery('base').attr('href');
        jQuery('a').each(function() {
            var href = jQuery(this).attr('href');
            if (href && (href.match(/^https?\:/i)) && (!href.match(document.domain))) {
                jQuery(this).click(function() {
                    var extLink = href.replace(/^https?\:\/\//i, '');
                    _gaq.push(['_trackEvent', 'External', 'Click', extLink]);
                    if (jQuery(this).attr('target') != undefined && jQuery(this).attr('target').toLowerCase() != '_blank') {
                        setTimeout(function() { location.href = href; }, 200);
                        return false;
                    }
                });
            }
            else if (href && href.match(/^mailto\:/i)) {
                jQuery(this).click(function() {
                    var mailLink = href.replace(/^mailto\:/i, '');
                    _gaq.push(['_trackEvent', 'Email', 'Click', mailLink]);
                });
            }
            else if (href && href.match(filetypes)) {
                jQuery(this).click(function() {
                    var extension = (/[.]/.exec(href)) ? /[^.]+$/.exec(href) : undefined;
                    var filePath = href;
                    _gaq.push(['_trackEvent', 'Download', 'Click-' + extension, filePath]);
                    if (jQuery(this).attr('target') != undefined && jQuery(this).attr('target').toLowerCase() != '_blank') {
                        setTimeout(function() { location.href = baseHref + href; }, 200);
                        return false;
                    }
                });
            }
        });
    });
}*/
	/*$(function() {
		$("#preload").fadeOut(2000);
	});
   $(document).ready(function () {$("#preload").hide()});
   $(document).ready(function () {$("#app").show()});*/
   $(document).ready(function checkUncheck() { 
    $("#pChk").click(function() {
        if (this.checked) {
            $("#AO").show('fast');
        } else {
            $("#AO").hide('fast');
        }
    });   
    });
    </script>
	</head>
	<body>
		 	
		<div id="app">
			<div style="line-height:150%">
				<div style="opacity: 0.95;">
					<h1>ReplicabilityFDR</h1>
					<h3><em>A method for computing the  <em>r</em>-values from primary and follow-up studies</em></h3>
				<h4 style="margin-top: 19px;"><em>By <a href="http://www.math.tau.ac.il/~ruheller/index.html" target="_blank">Ruth Heller</a>, Marina Bogomolov and <a href="http://www.math.tau.ac.il/~ybenja/" target="_blank">Yoav Benjamini</a></em></h4>
				</div>
				<hr / style="width:500px">
			
				<p>When many hypotheses are simultaneously examined in a primary study,
				and then a subset of hypotheses are forwarded for follow-up in an
				independent study, it is of interest to know which findings are
				replicated across studies. As a measure of replicability of
				significance, we compute the <em>r</em>-value, i.e. the FDR adjusted replicability <em>p</em>-value,
				for each hypothesis followed-up. This measure is different than the
				FDR adjusted <em>p</em>-value in a typical meta-analysis, where a <em>p</em>-value
				close to zero in one of the studies is enough to declare the finding
				as highly significant. The FDR <em>r</em>-value for a feature is the smallest FDR level <em>q</em> at which we can say that the finding is among the replicated ones.</p>
				
				<p>For full details on the procedure see the paper <em>"Deciding whether follow-up studies have replicated findings in a preliminary large-scale "omics' study"</em> 
				<a href="http://arxiv.org/abs/1310.0606" target="_blank">.pdf file</a> (also <em>"Discovering Ô¨Åndings that replicate from a primary study of high dimension to a follow-up study"</em> <a href="http://arxiv.org/pdf/1207.0187v3.pdf" target="_blank">.pdf file</a>).<br>
				For related discussions of other replicability problems and their solutions please visit our <a href="http://www.replicability.tau.ac.il/" target="_blank">replicability website</a>.</p>
				<p>The procedure is also available as R function. <a href="http://www.runmycode.org/companion/view/542" target="_blank">R Script on RunMyCode</a>.</p>
				<p><em>Applet Browser Compatibility</em> : latest versions of Chrome, Firefox, IE and Opera.</p>
				
				
				</div>
			<hr / style="width:500px">

			<h2>The Procedure:</h2>
			<ol class="circle-list">
				
				<li>
					<p>Enter &nbsp;\(m\), the number of hypotheses in the <strong>primary</strong> study:</p>
					
					<p style="text-align:center">\(m =\) <input type="number" name="m" min="1" size="8"  /> </p>
				</li>
				
				<li>
					<p>Enter a comma-delimited file (.csv) containing three columns:</p>
					<ol style="list-style: lower-roman outside none">
						<li><p> indices\names of the hypotheses followed-up.</p></li>
					    <li><p>One-sided <em>p</em>-values from the primary study for the hypotheses which are followed-up.</p>
						<p>If the primary study hypotheses are two sided, input the one-sided <em>p</em>-values in the direction
						favoured by the data. See <a href="http://xxx.tau.ac.il/abs/1503.02278" target="_blank">arXiv paper</a> for the theoretical justification.</p></li>
						<li><p>One-sided <em>p</em>-values from the follow-up study.</p></li>
					</ol>
					<p><a class="" id="exampletable" href="" onclick="return false;">example table and comma-delimited file (.csv)</a><br />
					<a href="http://www.math.tau.ac.il/~ruheller/Software/CrohnExample.csv" type="text/csv" target="_blank">Download</a>
					the example of <a href="http://www.nature.com/ng/journal/v40/n8/full/ng.175.html" target="_blank">Barrett et al. (2008)</a>, analyzed <a href="http://arxiv.org/pdf/1310.0606v1.pdf" target="_blank">here</a> ( m = 635547 )<br />
					(*) In Safari browser: right click the link and use "save as..." to save the file.</p>
					
					<p><input type="file" name="file" accept="text/csv"/></p>
					
					<div id="file_progress" class="progress progress-striped active shiny-file-input-progress"><div class="bar"></div></div>
				</li>
        <li>
          <p>Enter &nbsp;\(0 \leq l_{00} < 1\), the lower bound on the fraction of hypotheses that are null for both studies (out of \(m \)):</p>
  						<p><a class="" id="looexp" href="" onclick="return false;">explanation</a></p>
						
							<div id="looexpcontent" style="display:none">
							The family of \(m\) hypotheses examined in the primary study  contains a fraction \(f_{00}\) of
							hypotheses that are null in both studies. Exploiting the fact that
							\(f_{00}\) is typically closer to one than to zero, we can give a
							conservative guess for a lower bound on \(f_{00}\) , call it \(l_{00}\). For example, for  GWAS on the whole genome, the choice
							 \(l_{00}=0.8\) is conservative in typical applications.		
							</div>
							
							<p style="text-align:center">\(l_{00} =\) <input type="number" name="l00" value="0" min="0" max="1" size="4" step="0.01" /></p>
				</li>
				<li>
					<p><button id="goButton" type="button" class="btn action-button">Submit</button>&nbsp;<input type="checkbox" id="pChk"> Advanced Options.</p>
          <div id="AO" style="display:none">
  			
					<ul class="circle-list">
						<li>
							<p>Enter &nbsp; \(0 < c_{2} <1\):</p>
							<p><a class="" id="c2exp" href="" onclick="return false;">explanation</a></p>
							
							<div id="c2expcontent" style="display:none">
							 This is the parameter that determines how much boosting to give to the follow up study <em>p</em>-values relative to the primary study <em>p</em>-values. 
                                                         We recommend \(c_2 = 0.5\), since the power of the procedure with this parameter choice was observed to be similar to that of the optimal (unknown) parameter choice in simulations (see <a href="http://arxiv.org/pdf/1310.0606v1.pdf" target="_blank">article</a> for details). 
                                                         Note that  \(c_2\) has to be fixed in advance.  
							</div>
							
							<p style="text-align:center">\(c_{2} =\) <input type="number" name="c2" value="0.5" min="0" max="1" size="4" step="0.01" /></p>
						</li>	
						<li>
							<p>Enter &nbsp; \(0 < q <1\), the FDR level to control in the replicability analysis. We denote the <em>r</em>-values below this level with (*) in the results table:</p>
							<p><a class="" id="qexp" href="" onclick="return false;">explanation</a></p>

							<div id="qexpcontent" style="display:none">
							 The replicability claims are all hypotheses with <em>r</em>-values below this level.</div>

							<p style="text-align:center">\(q =\) <input  type="number" name="q" value="0.05" min="0" max="1" size="4" step="0.001" /></p>
						</li>
            <li> <div id="var" class="control-group shiny-input-radiogroup">
            <label class="control-label" for="var">Variation:</label><br>
              <label class="radio">
              <input type="radio" name="var" id="var1" value="none" checked="checked"/>
              <span>None</span>
              </label><br>
              <label class="radio">
              <input type="radio" name="var" id="var2" value="use.m.star"/>
              <span> Use &nbsp; \(m^*=m\sum_{i=1}^{m}\frac{1}{i}\) instead of \(m\).</span>
              <p><a class="" id="mexp" href="" onclick="return false;">explanation</a></p>
              <div id="mexpcontent" style="display:none">For any type of dependency of the p-values in the primary study, using \(m^*\) instead of \(m\) guarantees that the procedure that declares all <em>r</em>-values at most <em>q</em> as replicability claims, controls the FDR at level at most <em>q</em>
    					</div>
              </label>
              <label class="radio">
              <input type="radio" name="var" id="var3" value="use.t"/>
              <span> Use a penalty that depends on \(0 < t <1\), the selection rule threshold.
               </span>
               <p style="text-align:center"> Enter \(t=\) <input  type="number" name="t"  min="0" max="1" size="4"/></p>
              <p><a class="" id="texp" href="" onclick="return false;">explanation</a></p> 
              <div id="texpcontent" style="display:none">If the selection rule includes the criterion that only features with primary study <em>p</em>-values at most a fixed threshold may be followed-up, then <em>t</em> is this threshold. We use <em>t</em> in a modified <em>r</em>-value computation detailed in item 3 of Theorem 1 of the paper. The resulting <em>r</em>-values are then used for quantifying the evidence of replicability. 
For any type of dependency of the <em>p</em>-values in the primary study,  the procedure that declares all features with  <em>r</em>-values at most <em>q</em> as features with replicated findings, controls the FDR at level <em>q</em>. 
      				</div>
              </label></div>
            </li>
          </ul>
  				</div>
				</li>
			</ol>
			<hr / style="width:500px">
			<h2>Output:</h2>
			<div   id="log" class="shiny-html-output"></div>
      <div data-display-if="output.table">
      <a id="downloadtable" class="shiny-download-link" href="" target="_blank">Download table (.csv file)</a>
    	</div>
      <div   id="table" class="shiny-html-output"></div>
      
			<hr / style="width:500px">
			<h4>Support:</h4>
			<p>For technical support, bug reporting and further information on the applet, please contact Shay Yaacoby at <a href="mailto:shay66[at]gmail.com" target="_blank">shay66[at]gmail.com</a>
					or Ruth Heller at <a href="mailto:ruheller[at]post.tau.ac.il" target="_blank">ruheller[at]post.tau.ac.il</a>.</p>
			<!--<p>The applet is kindly hosted on <a href="http://www.rstudio.com/" target="_blank">RStudio</a> servers and powered by <a href="http://shiny.rstudio.com/" target="_blank">Shiny</a></p>-->
			<p>
		        The construction of this  website and software implementation was supported by the European Research Council (ERC) 
under the European Community‚Äôs 7th Framework Program (FP/2007-2013) and ERC grant agreement (PSARPS-294519).
			</p>	
				
		</div>
				
				<script type="text/javascript">
				$(document).ready(function()
				{
					$("#exampletable").qtip({
					content:'\
					<div style="font: normal 15px/150% Arial, Helvetica, sans-serif">\
					<p>example table:</p>\
					<div class="datagrid">\
					<table>\
					<thead>\
					<tr><th>index</th><th>p1</th><th>p2</th></tr>\
					</thead>\
					<tbody>\
					<tr><td>1</td><td>8.66E-08</td><td>0.8</td></tr>\
					<tr class="alt"><td>2</td><td>1.50E-07</td><td>0.3</td></tr>\
					<tr><td>3</td><td>7.63E-09</td><td>0.002</td></tr>\
					<tr class="alt"><td>4</td><td>2.70E-08</td><td>6.55E-04</td>\
					</tr><tr><td>5</td><td>5.00E-08</td><td>5.82E-05</td></tr>\
					</tbody>\
					</table>\
					</div>\
					<p>example .csv file contents:</p>\
					<div style="font-family:\'Courier New\', Courier, monospace;font-size:14px">\
					<p>index,p1,p2<br />\
					1,8.66E-08,0.8<br />\
					2,1.50E-07,0.3<br />\
					3,7.63E-09,0.002<br />\
					4,2.70E-08,6.55E-04<br />\
					5,5.00E-08,5.82E-05</p></div></div>',
					show: 'mouseover',
					hide: 'mouseout',
					position: {
						corner: {
								target: 'rightTop',
								tooltip: 'leftBottom'
								}
							},
					style:	{
							width: {min: 0,max: 250},
							padding: 15,
							background: 'white',
							color: 'black',
							
							border: {
									width: 4,
									radius: 3,
									color: '#A2D959'
									},
							tip: 'leftBottom',
							name: 'light'
							}
					});
					$("#looexp").qtip({
					content:{
					prerender: true ,
					text:$("#looexpcontent").text()
					},
					show: 'mouseover',
					hide: 'mouseout',
					position: {
						corner: {
								target: 'rightTop',
								tooltip: 'leftBottom'
								}
							},
					style:	{
							width: {min: 0,max: 500},
							padding: 10,
							background: 'white',
							color: 'black',
							
							border: {
									width: 4,
									radius: 3,
									color: '#A2D959'
									},
							tip: 'leftBottom',
							name: 'light'
							}
					});
					$("#c2exp").qtip({
					content:{
					prerender: true ,
					text:$("#c2expcontent").text()
					},
					show: 'mouseover',
					hide: 'mouseout',
					position: {
						corner: {
								target: 'rightTop',
								tooltip: 'leftBottom'
								}
							},
					style:	{
							width: {min: 0,max: 500},
							padding: 10,
							background: 'white',
							color: 'black',
							
							border: {
									width: 4,
									radius: 3,
									color: '#A2D959'
									},
							tip: 'leftBottom',
							name: 'light'
							}
					});
					$("#qexp").qtip({
					content:{
					prerender: true ,
					text:$("#qexpcontent").text()
					},
					show: 'mouseover',
					hide: 'mouseout',
					position: {
						corner: {
								target: 'rightTop',
								tooltip: 'leftBottom'
								}
							},
					style:	{
							width: {min: 0,max: 500},
							padding: 10,
							background: 'white',
							color: 'black',
							
							border: {
									width: 4,
									radius: 3,
									color: '#A2D959'
									},
							tip: 'leftBottom',
							name: 'light'
							}
					});
          $("#texp").qtip({
  				content:{
					prerender: true ,
					text:$("#texpcontent").text()
					},
					show: 'mouseover',
					hide: 'mouseout',
					position: {
						corner: {
								target: 'rightTop',
								tooltip: 'leftBottom'
								}
							},
					style:	{
							width: {min: 0,max: 500},
							padding: 10,
							background: 'white',
							color: 'black',
							
							border: {
									width: 4,
									radius: 3,
									color: '#A2D959'
									},
							tip: 'leftBottom',
							name: 'light'
							}
					});
          $("#mexp").qtip({
  				content:{
					prerender: true ,
					text:$("#mexpcontent").text()
					},
					show: 'mouseover',
					hide: 'mouseout',
					position: {
						corner: {
								target: 'rightTop',
								tooltip: 'leftBottom'
								}
							},
					style:	{
							width: {min: 0,max: 500},
							padding: 10,
							background: 'white',
							color: 'black',
							
							border: {
									width: 4,
									radius: 3,
									color: '#A2D959'
									},
							tip: 'leftBottom',
							name: 'light'
							}
					});
					
				});
				</script>	
	</body>
</html>
